name: build and test

on: [push, pull_request]

jobs:
  iomidipp_ci_unix:
    name: iomidipp_ci (${{ matrix.os }})
    runs-on: ${{ matrix.os }}
    env:
      source-dir: ./sources
      build-dir: ./build
      install-prefix: ./install
    strategy:
      fail-fast: false
      matrix:
        os: ['ubuntu-latest', 'macos-latest']
    steps:
      - uses: actions/checkout@v2
      - name: create build and install dir
        shell: bash -l {0}
        run: mkdir ${{build-dir}} && mkdir ${{install-prefix}}
      - name: Get latest CMake and ninja
        uses: lukka/get-cmake@latest
      - name: configure, build, install, test
        shell: bash -l {0}
        run: |
          cmake -DIOMIDIPP_CREATE_TEST_TARGET=BOOL:ON -DCMAKE_INSTALL_PREFIX="${INSTALL_PREFIX}" ${SOURCE_DIR}
          cmake --build
          cmake --build . --target install
          cd ${INSTALL_PREFIX}/bin
          ./iomidipp_tests.exe
        working-directory: ${{build-dir}}
        env:
          INSTALL_PREFIX: ${{ install-prefix }}
          SOURCE_DIR: ${{ source-dir }}
#  iomidipp_ci_windows:
#    name: iomidipp_ci (${{ matrix.os }})
#    runs-on: ${{ matrix.os }}
#    strategy:
#      fail-fast: false
#      matrix:
#        os: ['windows-latest']
